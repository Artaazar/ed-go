<?xml version="1.0" encoding="UTF-8"?>
<include>
	<!--  -->
	<table name="events">
		<column name="json_md5" type="String"/>
		<select name="ByPrimaryKey" single_object="true">
			<column name="event_id"/>
		</select>
		<!-- 
		<select name="UnlockEvent" single_object="true">
			<column name="is_locked" condition="=" value="0"/>
			<sort>event_id ASC</sort>
		</select>
		 -->
		<update name="ByPrimaryKey">
			<column name="event_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="event_id"/>
		</delete>
		<query name="UnlockEvent" single_object="true" use="Events">
			<sql>
				SELECT e.*, MD5(e.event_json) as json_md5
				FROM events e
				WHERE e.is_locked = 0
				ORDER BY event_id ASC
				LIMIT 1
			</sql>
		</query>
	</table>
	<!--  -->
	<table name="location_history">
		<column name="system_name" type="String">
	    	<annotation>@XMLSimple("systemName")</annotation>
		</column>
		<column name="station_name" type="String">
	    	<annotation>@XMLSimple("stationName")</annotation>
		</column>
		<select name="ByPrimaryKey" single_object="true">
			<column name="location_id"/>
		</select>
		<select name="LastLocation" single_object="true">
			<column name="pilot_id"/>
			<sort>location_time DESC</sort>
		</select>
		<query name="LastLocationForPilot" use="LocationHistory" single_object="true">
			<column name="PilotId" type="long"/>
			<sql>
				SELECT l.*, sy.name as system_name, st.name as station_name
				FROM location_history l
				LEFT JOIN systems sy ON l.system_id = sy.system_id
				LEFT JOIN stations st ON l.station_id = st.station_id
				WHERE l.pilot_id = ?
				ORDER BY location_time DESC
				LIMIT 1 
			</sql>
		</query>
	</table>
	<!--  -->
	<table name="ranks">
		<select name="ByPrimaryKey" single_object="true">
			<column name="pilot_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="pilot_id"/>
		</update>
	</table>
	<!--  -->
	<table name="progress">
		<select name="ByPrimaryKey" single_object="true">
			<column name="pilot_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="pilot_id"/>
		</update>
	</table>
	<!--  -->
	<table name="events_history">
		<select name="ByPrimaryKey" single_object="true">
			<column name="events_history_id"/>
		</select>
		<select name="ByUserIdTimestampAndHash" single_object="true">
			<column name="user_id"/>
			<column name="event_timestamp"/>
			<column name="event_hash"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="events_history_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="events_history_id"/>
		</delete>
	</table>
	<!--  -->
</include>