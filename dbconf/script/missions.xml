<?xml version="1.0" encoding="UTF-8"?>
<include>
	<!--  -->
	<table name="missions">
		<select name="ByPrimaryKey" single_object="true">
			<column name="mission_id"/>
		</select>
		<select name="ByPilotIdAndLinkId" single_object="true">
			<column name="pilot_id"/>
			<column name="mission_link_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="mission_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="mission_id"/>
		</delete>
		<query name="getLastComplitedByPilotId" use="Missions" single_object="true">
			<column name="pilot_id" type="long"/>
			<sql>
				SELECT m.* 
				FROM missions m 
				WHERE m.pilot_id = ?
				AND NOT ISNULL(m.complete_date)
				ORDER BY m.complete_date DESC
				LIMIT 1 
			</sql>
		</query>
		<query name="MissionsComplitedListByPilots" intruder="org.c3s.edgo.common.intruders.InInjector">
			<result_column name="commodity_id" type="Integer[]">
	    		<annotation>@XMLSimple</annotation>
			</result_column>
			<result_column name="material_id" type="Integer[]">
	    		<annotation>@XMLSimple</annotation>
			</result_column>
			<sql>
				SELECT m.*, t.*, f.faction_id, f.name as faction_name, s.name as system_name, st.name as station_name,
					GROUP_CONCAT(DISTINCT rc.commodity_id SEPARATOR ',') as commodity_idx, GROUP_CONCAT(DISTINCT rm.material_id SEPARATOR ',') as material_idx
				FROM mission_types t, factions f, (missions m, location_history l)
				LEFT JOIN reward_commodities rc ON rc.mission_id = m.mission_id 
				LEFT JOIN reward_materials rm ON rm.mission_id = m.mission_id
				LEFT JOIN systems s ON s.system_id = l.system_id
				LEFT JOIN stations st ON st.station_id = l.station_id
				WHERE 1=1 
				<where/>
				AND NOT ISNULL(m.complete_date)
				AND t.mission_type_id = m.mission_type_id
				AND f.faction_id = m.faction_id
				AND l.location_id = m.source_location_id
				GROUP BY m.mission_id 
				ORDER BY m.complete_date DESC
			</sql>
		</query>
	</table>
	<!--  -->
	<table name="mission_types">
		<select name="ByPrimaryKey" single_object="true">
			<column name="mission_type_id"/>
		</select>
		<select name="ByUniq" single_object="true">
			<column name="mission_type_uniq"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="mission_type_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="mission_type_id"/>
		</delete>
	</table>
	<!--  -->
	<table name="reward_commodities">
		<select name="ByPrimaryKey" single_object="true">
			<column name="mission_id"/>
			<column name="commodity_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="mission_id"/>
			<column name="commodity_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="mission_id"/>
			<column name="commodity_id"/>
		</delete>
	</table>
	<!--  -->
	<table name="reward_materials">
		<select name="ByPrimaryKey" single_object="true">
			<column name="mission_id"/>
			<column name="material_id"/>
		</select>
		<update name="ByPrimaryKey">
			<column name="mission_id"/>
			<column name="material_id"/>
		</update>
		<delete name="ByPrimaryKey">
			<column name="mission_id"/>
			<column name="material_id"/>
		</delete>
	</table>
	<!--  -->
</include>